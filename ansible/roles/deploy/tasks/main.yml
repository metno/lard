---
# TODO: do we need separate user/groups? Can't we simply use ubuntu?
- name: Create lard group
  ansible.builtin.group:
    name: lard
    state: present

- name: Create lard user
  ansible.builtin.user:
    name: lard
    groups: lard
    shell: /sbin/nologin
    append: true
    state: present
    create_home: false

# TODO: should we deploy in non root user?
- name: Copy files to server
  ansible.builtin.copy:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    mode: "{{ item.mode }}"
    owner: root
    group: root
  loop: "{{ deploy_files }}"

- name: Start LARD ingestion service
  ansible.builtin.systemd:
    daemon_reload: true
    name: lard_ingestion
    state: restarted
    enabled: true
